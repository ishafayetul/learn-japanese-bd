<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Japanese N5 â€” Vocab Practice</title>
  <link rel="icon" href="data:," />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Auth Gate -->
  <div id="auth-gate" class="auth-gate">
    <div class="auth-card">
      <h1>Learn Japanese N5</h1>
      <p class="muted">Sign inï¼ˆã‚µã‚¤ãƒ³ã‚¤ãƒ³ï¼‰with Google to save progressï¼ˆã»ãã‚“ï¼‰.</p>
      <button id="auth-btn">ğŸ” Sign in with Google</button>
      <p id="auth-error" class="error" style="display:none;"></p>
    </div>
  </div>

  <!-- App -->
  <div id="app-root" class="layout hidden">
    <nav class="sidebar">
      <h2>ğŸ“˜ Menuï¼ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼‰</h2>
      <button onclick="showSection('deck-select')">ğŸ“š Vocabï¼ˆãŸã‚“ã”ï¼‰</button>
      <button onclick="showSection('grammar-section')">ğŸ“– Grammarï¼ˆã¶ã‚“ã½ã†ï¼‰</button>
      <button onclick="showSection('practice-grammar-section')">âœï¸ Practice Grammar</button>
      <button onclick="showSection('progress')">ğŸ“ˆ Progressï¼ˆã—ã‚“ã¡ã‚‡ãï¼‰</button>
      <button onclick="showSection('mistakes-section')">â— Mistakesï¼ˆã¾ã¡ãŒã„ï¼‰</button>
      <button onclick="showSection('marked-section')">ğŸ“Œ Marked Words</button>
      <button onclick="saveCurrentScore()">ğŸ’¾ Save Progress</button>
      <button onclick="window.__signOut?.()">ğŸšª Sign out</button>
    </nav>

    <div class="main-content">
      <header class="topbar">
        <h1>Japanese Vocabulary Practice</h1>
        <div id="score">
          âœ… Correct: <b id="score-correct">0</b>
          âŒ Wrong: <b id="score-wrong">0</b>
          â– Skipped: <b id="score-skipped">0</b>
        </div>
      </header>

      <!-- Global deck progress (shared by Learn/Practice/Write) -->
      <div id="global-progress" class="deck-progress">
        <div id="deck-progress-bar" class="deck-progress-bar"></div>
        <div id="deck-progress-text" class="deck-progress-text">0 / 0 (0%)</div>
      </div>

      <main>
        <!-- 1) Deck Select -->
        <section id="deck-select">
          <h2>Choose a deckï¼ˆã§ã£ãï¼‰</h2>
          <p id="deck-status" class="muted"></p>
          <div id="deck-buttons"></div>

          <!-- Mixed Multiples -->
          <div class="card" style="margin-top:12px;">
            <details>
              <summary><b>ğŸ§© Mixed Multiplesï¼ˆã¿ã£ãã™ï¼‰</b></summary>
              <p class="muted">Select multiple decks to combine.</p>
              <div id="mix-deck-list" class="mix-list"></div>
              <div class="practice-actions">
                <button onclick="multiSelectDeckAll()">Select All</button>
                <button onclick="multiSelectDeckNone()">Clear</button>
              </div>
              <div class="practice-actions">
                <!-- MCQ, 4 options -->
                <button onclick="startPractice('jp-en')">Mixed: Hiragana â†’ English</button>
                <button onclick="startPractice('en-jp')">Mixed: English â†’ Hiragana</button>
                <button onclick="startPractice('kanji-hira')">Mixed: Kanji â†’ Hiragana</button>
                <button onclick="startPractice('hira-kanji')">Mixed: Hiragana â†’ Kanji</button>
                <!-- Dual 6 options -->
                <button onclick="startPractice('k2hm')">Mixed: Kanji â†’ (Hiragana & Meaning)</button>
                <button onclick="startPractice('hm2k')">Mixed: (Hiragana & Meaning) â†’ Kanji</button>
                <!-- Writing -->
                <button onclick="startWrite('write-kanji-hira')">Write: Kanji â†’ Hiragana</button>
                <button onclick="startWrite('write-en-hira')">Write: English â†’ Hiragana</button>
              </div>
              <p id="deck-multi-status" class="muted"></p>
            </details>
          </div>
        </section>

        <!-- 2) Mode Select -->
        <section id="mode-select" class="hidden">
          <h2>Select Modeï¼ˆã‚‚ãƒ¼ã©ï¼‰</h2>

          <!-- Learn -->
          <div class="stack">
            <h3>Learnï¼ˆãŒãã—ã‚…ã†ï¼‰</h3>
            <div class="practice-actions">
              <button onclick="startLearn('learn-hira-en')">Learn: Hiragana â†’ English</button>
              <button onclick="startLearn('learn-kanji-hira')">Learn: Kanji â†’ Hiragana</button>
            </div>
          </div>

          <!-- MCQ -->
          <div class="stack">
            <h3>MCQï¼ˆãˆã‚€ã—ãƒ¼ãã‚…ãƒ¼ï¼‰</h3>
            <div class="practice-actions">
              <button onclick="startPractice('jp-en')">Hiragana â†’ English</button>
              <button onclick="startPractice('en-jp')">English â†’ Hiragana</button>
              <button onclick="startPractice('kanji-hira')">Kanji â†’ Hiragana</button>
              <button onclick="startPractice('hira-kanji')">Hiragana â†’ Kanji</button>
              <button onclick="startPractice('hm2k')">Hiragana & Meaning â†’ Kanji (6)</button>
              <button onclick="startPractice('k2hm')">Kanji â†’ Hiragana & Meaning (6)</button>
            </div>
          </div>

          <!-- Writing -->
          <div class="stack">
            <h3>Writingï¼ˆã‚‰ã„ã¦ãƒã‚“ãï¼‰</h3>
            <div class="practice-actions">
              <button onclick="startWrite('write-kanji-hira')">Write: Kanji â†’ Hiragana</button>
              <button onclick="startWrite('write-en-hira')">Write: English â†’ Hiragana</button>
            </div>
          </div>
        </section>

        <!-- 3) Learn -->
        <section id="learn" class="hidden">
          <div id="learn-card"></div>
        </section>

        <!-- 4) Practice (MCQ) -->
        <section id="practice" class="hidden">
          <div id="question-box" class="flashcard"></div>
          <ul id="options" class="options"></ul>

          <div class="practice-actions">
            <button onclick="skipQuestion()">Skipï¼ˆã‚¹ã‚­ãƒƒãƒ—ï¼‰ [Esc]</button>
            <button onclick="showRomaji()">ğŸ‘ Show Details</button>
            <button onclick="showMeaning()">ğŸ’¡ Show Meaning</button>
            <button id="practice-mark-btn" onclick="markCurrentWord()">ğŸ“Œ Mark</button>
          </div>
          <div id="extra-info" class="muted" style="margin-top:8px;"></div>
        </section>

        <!-- 5) Writing -->
        <section id="write" class="hidden">
          <div id="write-area"></div>
        </section>

        <!-- 6) Progress -->
        <section id="progress" class="hidden">
          <h2>ğŸ“ˆ Your Progressï¼ˆã—ã‚“ã¡ã‚‡ãï¼‰</h2>
          <div class="table" id="progress-table"></div>
        </section>

        <!-- 7) Marked Words -->
        <section id="marked-section" class="hidden">
          <h2>ğŸ“Œ Marked Words</h2>
          <div id="marked-list" class="stack" style="margin-bottom:12px;"></div>
          <div class="stack">
            <h3>Start a mode</h3>
            <div class="practice-actions">
              <select id="marked-mode" class="select">
                <option value="jp-en">Hiragana â†’ English</option>
                <option value="en-jp">English â†’ Hiragana</option>
                <option value="kanji-hira">Kanji â†’ Hiragana</option>
                <option value="hira-kanji">Hiragana â†’ Kanji</option>
                <option value="hm2k">Hiragana & Meaning â†’ Kanji (6)</option>
                <option value="k2hm">Kanji â†’ Hiragana & Meaning (6)</option>
                <option value="write-en-hira">Write: English â†’ Hiragana</option>
                <option value="write-kanji-hira">Write: Kanji â†’ Hiragana</option>
              </select>
              <button onclick="startMarkedMode(document.getElementById('marked-mode').value)">Start</button>
            </div>
          </div>
        </section>

        <!-- 8) Mistakes -->
        <section id="mistakes-section" class="hidden">
          <h2>â— Mistakesï¼ˆã¾ã¡ãŒã„ï¼‰</h2>
          <p id="mistakes-status" class="muted"></p>
          <div class="stack">
            <h3>Start a mode</h3>
            <div class="practice-actions">
              <select id="mistakes-mode" class="select">
                <option value="jp-en">Hiragana â†’ English</option>
                <option value="en-jp">English â†’ Hiragana</option>
                <option value="kanji-hira">Kanji â†’ Hiragana</option>
                <option value="hira-kanji">Hiragana â†’ Kanji</option>
                <option value="hm2k">Hiragana & Meaning â†’ Kanji (6)</option>
                <option value="k2hm">Kanji â†’ Hiragana & Meaning (6)</option>
                <option value="write-en-hira">Write: English â†’ Hiragana</option>
                <option value="write-kanji-hira">Write: Kanji â†’ Hiragana</option>
              </select>
              <button onclick="startMistakesMode(document.getElementById('mistakes-mode').value)">Start</button>
              <button onclick="localStorage.removeItem('mistakes'); location.reload()">ğŸ—‘ Clear Mistakes</button>
            </div>
          </div>
        </section>

        <!-- 9) Grammar -->
        <section id="grammar-section" class="hidden">
          <h2>ğŸ“– Grammar Lessonsï¼ˆã¶ã‚“ã½ã†ï¼‰</h2>
          <p id="grammar-status" class="muted"></p>
          <div id="grammar-list" class="stack"></div>
        </section>

        <!-- 10) Practice Grammar -->
        <section id="practice-grammar-section" class="hidden">
          <h2>âœï¸ Practice Grammar</h2>
          <p id="practice-grammar-status" class="muted"></p>
          <div id="practice-grammar-list" class="pg-files"></div>
        </section>

        <!-- Toast -->
        <div id="toast" class="toast"></div>
      </main>
    </div>
  </div>

  <script type="module" src="firebase.js"></script>
  <script src="script.js"></script>
</body>
</html>
