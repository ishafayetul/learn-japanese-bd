/* =========================================================
   Learn Japanese â€” Minimal, responsive UI (dark-friendly)
   Works with index.html + script.js (no-manifest folder scan)
   ========================================================= */

:root{
  /* === Aurora theme â€” fixed (not tied to prefers-color-scheme) === */
  --bg: #0b1220;
  --bg-soft: #0f1830;
  --card: #101a2e;
  --text: #eaf0ff;
  --muted: #a9b4d0;

  /* Brand accents aligned with landing gradient */
  --accent: #8b5cf6;   /* violet */
  --accent-2: #22d3ee; /* cyan */

  /* Status & utility */
  --danger: #e05666;
  --warning: #f2c94c;
  --ok: #12b886;
  --bad: #e03131;

  /* Layout */
  --border: #25345a;
  --shadow: 0 10px 40px rgba(0,0,0,.35);
  --radius: 14px;

  /* Extras used in a few places */
  --panel: #101826;
  --panel-2: #0f1727;
  --link: #8b5cf6;
}



*{ box-sizing: border-box; }
html, body { height:100%; }
body{
  margin:0;
  font: 15px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  color: var(--text);
  background: radial-gradient(1200px 900px at 10% -10%, #20304a 0%, transparent 60%),
              radial-gradient(1200px 900px at 90% -10%, #13233b 0%, transparent 60%),
              var(--bg);
}

/* Layout */
.layout{
  display:grid;
  grid-template-columns: 260px 1fr;
  min-height:100vh;
}
.sidebar{
  position:sticky; top:0;
  padding:16px;
  background: linear-gradient(180deg, var(--bg-soft), transparent 220px), transparent;
  border-right:1px solid var(--border);
  min-height:100vh;
}
.sidebar h2{ margin:6px 0 10px; font-size:18px; }
.sidebar button{
  width:100%; text-align:left; margin-bottom:8px;
}
.main-content{ min-width:0; }
.topbar{
  display:flex; justify-content:space-between; align-items:center;
  padding:10px 16px; border-bottom:1px solid var(--border);
  position:sticky; top:0; background:linear-gradient(180deg,var(--bg),rgba(0,0,0,0));
  z-index:4;
}
.crumbs{ opacity:.9; font-weight:600; }
.crumbs .sep{ margin:0 6px; opacity:.5; }

.hidden{ display:none !important; }
.muted{ color: var(--muted); }

/* Cards & sections */
.card{
  background: var(--card);
  border:1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding:14px;
  margin-top:12px;
}
.level-head h2{ margin:12px 0 0; }
.lesson-list{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(140px,1fr));
  gap:10px;
}
.lesson-item{
  padding:12px 10px; border:1px solid var(--border); border-radius:12px;
  background:linear-gradient(180deg, #1a2436, #131a29);
  cursor:pointer; user-select:none; text-align:center; font-weight:600;
  transition: transform .12s ease, border-color .12s ease;
}
.lesson-item:hover{ transform: translateY(-1px); border-color:#3a5a8a; }
.lesson-item:active{ transform: translateY(0); }

/* Tabs */
.lesson-bar{ display:flex; gap:12px; align-items:center; justify-content:space-between; }
.lesson-meta{ display:flex; flex-direction:column; gap:6px; }
.lesson-tabs{ display:flex; gap:8px; flex-wrap:wrap; }
.tab-btn{
  border:1px solid var(--border);
  background: #121a2a;
  color: var(--text);
  padding:8px 12px; border-radius:10px; font-weight:600;
}
.tab-btn[aria-selected="true"]{
  outline:2px solid #3a6bff50;
  background:#14234a; border-color:#3657a5;
}
.tab-pane{ margin-top:10px; }

/* Buttons (global) */
button{
  appearance: none; border:1px solid var(--border);
  background: #0f1726; color: var(--text);
  padding:8px 10px; border-radius:10px; cursor:pointer;
  font-weight:600; transition: transform .12s ease, background .12s ease, border-color .12s ease, box-shadow .12s ease;
}
button:hover{ transform: translateY(-1px); background:#15203a; }
button:active{ transform: translateY(0); }
button.danger{ border-color: #3e2023; background:#261013; color:#ffd9de; }
button.save{ border-color:#194626; background:#0f2218; color:#b9ffd1; }

button.chip{
  border-radius:999px; padding:7px 12px;
  background:#0f1a2b; border-color:#1c2a47; white-space:nowrap;
}
button.chip:hover{ background:#132340; }

/* Video Module */
.file-button-row{
  display:flex; gap:8px; flex-wrap:wrap;
  overflow:auto; padding-bottom:6px;
}
.video-grid{
  display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
  gap:12px; margin-top:10px;
}
.video-card{
  text-align:left; padding:8px; background:#0e1524; border-color:#1b2943;
}
.video-card .video-thumb{
  position:relative; border-radius:10px; overflow:hidden; border:1px solid var(--border);
}
.video-card img{
  display:block; width:100%; height:140px; object-fit:cover;
}
.play-badge{
  position:absolute; inset:auto 8px 8px auto;
  background: #17233c; color:#fff; padding:4px 8px; border-radius:999px; border:1px solid #2c3d62;
  font-weight:700; font-size:12px;
}
.yt-wrap{ position:relative; width:100%; aspect-ratio:16/9; border-radius:10px; overflow:hidden; border:1px solid var(--border); }

/* Vocab & Practice */
.flashcard{
  margin-top:15px; padding:18px; border-radius:16px;
  background: radial-gradient(600px 260px at -10% -10%, #202f4d 0%, transparent 60%), #0e1423;
  border:1px solid #283a5f;
  font-size:1em; text-align:center;
}
#options{
  list-style:none; padding:0; margin:12px 0 0;
  display:grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr)); gap:10px;
}
#options li button{
  width:100%; padding:10px 12px; border-radius:12px; text-align:center;
  border-color:#263656; background:#0c1321;
}
#options li button.is-correct{ border-color:#1b5a2c; background:#0e2a18; color:#bcffc9; }
#options li button.is-wrong{ border-color:#5a1b1b; background:#2a0e0e; color:#ffd0d0; }

.dual-grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px; }
.dual-grid > div{ display:grid; grid-template-columns:1fr; gap:8px; }
.dual-grid button{ padding:10px; }

.deck-progress{
  position:relative; background:#0e1524; border:1px solid var(--border);
  height:12px; border-radius:999px; overflow:hidden;
}
.deck-progress + .deck-progress-text{ margin-top:6px; text-align:right; font-size:12px; color:var(--muted); }
.deck-progress-bar{
  height:100%; width:0%; background: linear-gradient(90deg, #2f7bff, #7bd389);
}

.practice-actions{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }

/* Learn Notes */
.learn-note-card{ margin-top:10px; }
.learn-note-row{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
.learn-note-label{ font-weight:700; }
.learn-note-status{ font-size:12px; }
.learn-note-input{
  margin-top:6px; width:100%; min-height:84px;
  background:#0e1524; color:var(--text); border:1px solid var(--border);
  border-radius:12px; padding:10px; resize:vertical;
}

/* Write / Grammar inputs */
.pg-input-row{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-top:10px; }
.pg-input, .make-textarea{
  flex:1 1 260px; padding:10px 12px; border-radius:10px;
  background:#0e1524; color:var(--text); border:1px solid var(--border);
}
.pg-feedback{ margin-top:8px; min-height:20px; }
.ok-inline{ color:#a7ffbe; font-weight:700; }
.error-inline{ color:#ffb2b2; font-weight:700; }

/* Progress tables */
.table-wrap{ overflow:auto; border:1px solid var(--border); border-radius:12px; }
.progress-table{ width:100%; border-collapse:collapse; }
.progress-table th, .progress-table td{
  padding:10px 12px; border-bottom:1px solid var(--border); white-space:nowrap;
}
.progress-table thead th{ background:#0f1727; text-align:left; }

/* Marked / SignWord */
.marked-item, .sw-item{
  display:flex; align-items:center; justify-content:space-between;
  gap:10px; border:1px solid var(--border); background:#0e1524; padding:10px 12px; border-radius:12px; margin-bottom:8px;
}

/* Toast */
.toast{
  position:fixed; left:50%; bottom:18px; transform: translate(-50%, 30px);
  background:#0f1c31; color:#fff; border:1px solid #27406e;
  padding:10px 14px; border-radius:999px; box-shadow: var(--shadow);
  opacity:0; pointer-events:none; transition: opacity .18s ease, transform .18s ease;
  z-index:10;
}
.toast.show{ opacity:1; transform: translate(-50%, 0); }

/* Auth */
.auth-gate{
  min-height:100vh; display:grid; place-items:center; padding:16px;
}
.auth-card{
  width:min(560px, 92vw); background:var(--card); border:1px solid var(--border);
  border-radius:16px; padding:18px; box-shadow: var(--shadow); text-align:center;
}

/* Code inline */
code{ background:#0c1424; border:1px solid var(--border); padding:1px 6px; border-radius:6px; color:#c6d6ff; }

/* Focus visibility */
:focus-visible{
  outline: 2px solid #4d74ff;
  outline-offset: 2px;
  border-radius: 8px;
}

/* Small helpers */
/* Score chips */
.score{
  display:flex;
  align-items:center;
  gap:8px;
  font-weight:700;
}
.score .kpi{
  display:flex;
  align-items:center;
  gap:6px;
  padding:4px 10px;
  line-height:1;
  border:1px solid var(--border);
  border-radius:999px;
  background:var(--panel-2);
  box-shadow: var(--shadow);
}
.score .kpi.ok{  color:var(--ok); }
.score .kpi.bad{ color:var(--bad); }
.score .kpi.skip{ color:var(--muted); }
.score .kpi .kpi-ico{ font-size:14px; line-height:1; }

.error{ color: var(--danger); }

/* Responsive tweaks */
@media (max-width: 980px){
  .layout{ grid-template-columns: 1fr; }
  .sidebar{ position:relative; min-height:auto; border-right:none; border-bottom:1px solid var(--border); }
  .topbar{ position:sticky; top:0; }
}

/* --- Video lightbox (moderate large) --- */
.lightbox{
  position: fixed; inset: 0; z-index: 50;
  display: grid; place-items: center;
}
.lightbox-backdrop{
  position: absolute; inset: 0;
  background: rgba(0,0,0,.6);
  backdrop-filter: blur(2px);
}
.lightbox-inner{
  position: relative; z-index: 1;
  width: min(920px, 94vw);
}
.lightbox-head{
  display:flex; align-items:center; justify-content:space-between;
  margin-bottom:10px;
}
.lightbox-close{
  border:1px solid var(--border);
  background:#0f1726; color: var(--text);
  padding:6px 10px; border-radius:10px; cursor:pointer;
}
/* Global Back button */
.back {
  background: var(--panel, #101826);
  color: var(--text, #e5e7eb);
  border: 1px solid var(--border, #263041);
  padding: 6px 12px;
  border-radius: 10px;
  cursor: pointer;
  margin: 8px 12px;
}
.back.hidden { display: none; }

/* (Optional) make lightbox explicitly centered if you use it */
.lightbox { position: fixed; inset: 0; z-index: 50; display: grid; place-items: center; }
.lightbox-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.6); backdrop-filter: blur(2px); }
.lightbox-inner { position: relative; z-index: 1; width: min(920px,94vw); }
.lightbox-head { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
.lightbox-close { border:1px solid var(--border); background:#0f1726; color: var(--text); padding:6px 10px; border-radius:10px; cursor:pointer; }
/* Coming soon message on empty levels */
#lesson-status.coming-soon {
  text-align: center;
  padding: 40px 0;
  font-size: 1.25rem;
  opacity: 0.85;
}
/* Dual MCQ coloring (match single-MCQ styles) */
#options .dual-grid button.is-correct {
  background: var(--ok, #12b886);
  color: #fff;
  border-color: var(--ok, #12b886);
}
#options .dual-grid button.is-wrong {
  background: var(--err, #e03131);
  color: #fff;
  border-color: var(--err, #e03131);
}
#options .dual-grid button[disabled] {
  opacity: 0.6;
  cursor: default;
}

.mix-level { border: 1px solid var(--border, #ddd); border-radius: 10px; padding: 10px; margin: 10px 0; }
.mix-level-head { display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; }
.mix-level-actions button { margin-left:6px; }
.mix-lessons { display:grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap:6px 12px; }
.mix-levels-wrap { margin-top:8px; }
.action-row{display:flex; gap:.5rem; justify-content:flex-end; margin:0 0 .5rem;}
.action-row .danger{background:#3a1a1a;}

/* Unmark modal */
.unmark-list{
  display:grid;
  grid-template-columns: 1fr;
  gap:8px;
  padding:6px 2px;
  max-height:60vh;
  overflow:auto;
}
.unmark-list label{
  display:flex; align-items:center; gap:10px;
  padding:8px 10px; border:1px solid var(--border);
  background:#0e1524; border-radius:10px;
}
.unmark-actions{
  display:flex; align-items:center; justify-content:space-between;
  gap:10px; margin-top:10px;
}
/* Leaderboard (nice look) */
.leaderboard-wrap { margin-top: 8px; }

.leaderboard-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
}

.leaderboard-table thead th {
  background: #0f1727;
  position: sticky;
  top: 0;
  z-index: 1;
  text-align: left;
}

.leaderboard-table th,
.leaderboard-table td {
  padding: 10px 12px;
  border-bottom: 1px solid var(--border);
  white-space: nowrap;
}

.leaderboard-table tr:hover {
  background: rgba(255,255,255,.03);
}

.leaderboard-table .rank {
  width: 56px;
  text-align: center;
  font-weight: 800;
}

.leaderboard-table .player {
  display: flex;
  align-items: center;
  gap: 10px;
}

.leaderboard-table .avatar {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: inline-grid;
  place-items: center;
  font-weight: 800;
  background: #102037;
  border: 1px solid var(--border);
  overflow: hidden;
}
.leaderboard-table .avatar img { width: 100%; height: 100%; object-fit: cover; }

.leaderboard-table .name { font-weight: 700; }
.you-badge {
  font-size: 11px;
  border: 1px solid #2b3b59;
  padding: 2px 6px;
  border-radius: 999px;
  margin-left: 6px;
  color: #a7c0ff;
}

/* medal glow for top 3 */
.leaderboard-table tr.rank-1 { background: linear-gradient(90deg, rgba(255,215,0,.10), transparent); }
.leaderboard-table tr.rank-2 { background: linear-gradient(90deg, rgba(192,192,192,.10), transparent); }
.leaderboard-table tr.rank-3 { background: linear-gradient(90deg, rgba(205,127,50,.10), transparent); }

.leaderboard-table tr.rank-1 .rank::after { content: "ðŸ¥‡"; margin-left: 6px; }
.leaderboard-table tr.rank-2 .rank::after { content: "ðŸ¥ˆ"; margin-left: 6px; }
.leaderboard-table tr.rank-3 .rank::after { content: "ðŸ¥‰"; margin-left: 6px; }

.leaderboard-table .score {
  text-align: right;
  font-variant-numeric: tabular-nums;
}


/* ========== Landing (Auth Gate) ========== */
.landing {
  position: relative;
  min-height: 100dvh;
  display: grid;
  place-items: center;
  padding: 32px 16px;
  background: radial-gradient(1200px 600px at 80% -10%, rgba(255,255,255,0.25), transparent 60%),
              linear-gradient(135deg, #0b1220 0%, #0e1a34 55%, #0b1220 100%);
  overflow: hidden;
}

.landing .landing-bg::before,
.landing .landing-bg::after {
  content: "";
  position: absolute;
  inset: -20%;
  filter: blur(60px);
  opacity: 0.20;
  background:
    radial-gradient(500px 500px at 20% 30%, #8b5cf6, transparent 65%),
    radial-gradient(500px 500px at 80% 70%, #22d3ee, transparent 65%);
  z-index: 0;
}
.landing-wrap { width: min(1100px, 100%); position: relative; z-index: 1; }

.landing-header .brand { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
.landing-header .brand-badge {
  width: 40px; height: 40px; border-radius: 12px;
  display: grid; place-items: center;
  background: linear-gradient(135deg, #8b5cf6, #22d3ee);
  color: #0b1220; font-weight: 800;
  box-shadow: 0 8px 24px rgba(34,211,238,0.25), inset 0 0 25px rgba(255,255,255,0.35);
}
.landing-header h1 { margin: 0; font-size: 1.6rem; color: #fff; letter-spacing: .3px; }
.landing-header p.muted { margin: 2px 0 0; color: #a9b4d0; }

.landing .card {
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 16px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.35);
  backdrop-filter: blur(10px);
}

.landing-hero {
  display: grid;
  grid-template-columns: 1.1fr 1fr;
  gap: 22px;
  padding: 22px;
}
@media (max-width: 960px){
  .landing-hero { grid-template-columns: 1fr; }
}
.hero-left h2 { margin: 4px 0 8px; color: #e6ebff; font-size: 1.6rem; }
.hero-left p.muted { color: #a9b4d0; margin-bottom: 12px; }

.cta-row { display:flex; align-items:center; gap: 10px; flex-wrap: wrap; margin: 12px 0 10px; }
.btn-primary {
  appearance: none;
  border: 0; outline: 0;
  padding: 10px 14px;
  border-radius: 12px;
  background: linear-gradient(135deg, #8b5cf6, #22d3ee);
  color: #0b1220; font-weight: 700;
  box-shadow: 0 10px 25px rgba(34,211,238,0.25);
  cursor: pointer;
  transition: transform .04s ease, filter .2s ease;
}
.btn-primary:hover { filter: brightness(1.05); }
.btn-primary:active { transform: translateY(1px); }
.gicon {
  width: 22px; height: 22px; border-radius: 6px; display:inline-grid; place-items:center;
  background: #fff; color: #555; font-weight: 800; margin-right: 8px;
}

.auth-error {
  color: #ffb4b4; font-size: 0.9rem;
  padding: 6px 10px; border-radius: 8px;
  background: rgba(255, 0, 0, 0.12);
  border: 1px solid rgba(255, 0, 0, 0.16);
}

.hero-points { list-style: none; padding: 0; margin: 8px 0 0; color: #c6d1ef; display: grid; gap: 6px; }
.hero-points li { opacity: .9; }

.hero-right { display: grid; gap: 16px; }

.device {
  border-radius: 18px; padding: 10px;
  background: linear-gradient(135deg, rgba(255,255,255,.15), rgba(255,255,255,.03));
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.08);
}
.device-screen {
  height: 230px; border-radius: 12px; overflow: hidden;
  background: radial-gradient(600px 300px at 80% -30%, rgba(255,255,255,.10), transparent 60%),
              linear-gradient(135deg, #0b1530, #121b37);
  position: relative;
}
.kana-grid {
  position: absolute; inset: 0; display: grid; grid-template-columns: repeat(5, 1fr);
  align-content: center; justify-items: center; gap: 8px;
  color: rgba(255,255,255,0.2); font-size: 22px;
}
.kana-spark {
  position: absolute; pointer-events: none;
  font-size: 18px; color: rgba(255,255,255,0.8);
  filter: drop-shadow(0 8px 18px rgba(139,92,246,.35));
  animation: float-up linear forwards;
}
@keyframes float-up {
  from { transform: translateY(0) scale(1); opacity: .95; }
  to   { transform: translateY(-120px) scale(1.15); opacity: 0; }
}

.feature-grid {
  display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;
}
@media (max-width: 960px){ .feature-grid { grid-template-columns: repeat(2, 1fr); } }
.mini-card {
  padding: 12px; border-radius: 12px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.06);
}
.mini-icon { font-size: 22px; margin-bottom: 6px; }
.mini-title { color: #eaf0ff; font-weight: 700; }
.mini-text { font-size: .95rem; }

.landing-footer {
  display: flex; justify-content: center; margin-top: 14px;
}
.landing-footer .copyright {
  color: #99a8cc; font-size: .92rem;
}

/* utility */
.muted { color: #aeb7cf; }
/* === Landing Kana Panel dynamics === */
.kana-grid > div{
  opacity: .18;
  animation: kanaPulse 4.2s ease-in-out infinite;
}
@keyframes kanaPulse{
  0%   { opacity:.18; transform: translateY(0)    scale(1); }
  50%  { opacity:.38; transform: translateY(-2px) scale(1.02); }
  100% { opacity:.18; transform: translateY(0)    scale(1); }
}
/* staggered delays for 15 cells */
.kana-grid > div:nth-child(1) { animation-delay: .00s }
.kana-grid > div:nth-child(2) { animation-delay: .15s }
.kana-grid > div:nth-child(3) { animation-delay: .30s }
.kana-grid > div:nth-child(4) { animation-delay: .45s }
.kana-grid > div:nth-child(5) { animation-delay: .60s }
.kana-grid > div:nth-child(6) { animation-delay: .75s }
.kana-grid > div:nth-child(7) { animation-delay: .90s }
.kana-grid > div:nth-child(8) { animation-delay: 1.05s }
.kana-grid > div:nth-child(9) { animation-delay: 1.20s }
.kana-grid > div:nth-child(10){ animation-delay: 1.35s }
.kana-grid > div:nth-child(11){ animation-delay: 1.50s }
.kana-grid > div:nth-child(12){ animation-delay: 1.65s }
.kana-grid > div:nth-child(13){ animation-delay: 1.80s }
.kana-grid > div:nth-child(14){ animation-delay: 1.95s }
.kana-grid > div:nth-child(15){ animation-delay: 2.10s }

/* â€œsigningâ€ state â€” speed up pulse + gentle glow */
.device-screen.signing .kana-grid > div{
  animation-duration: 1.2s;
  opacity: .42;
}
.device-screen.signing::after{
  content:"";
  position:absolute; inset:0; pointer-events:none;
  background: radial-gradient(500px 220px at 50% 100%, rgba(139,92,246,.25), transparent 65%);
  animation: dsGlow 1s ease-out forwards;
}
@keyframes dsGlow { from{opacity:0} to{opacity:.25} }

/* ===== Mobile dropdown sidebar ===== */
.nav-toggle{
  display:none;
  border:1px solid var(--border);
  background:var(--panel);
  padding:6px 10px;
  border-radius:12px;
  align-items:center;
  gap:6px;
}
/* .nav-toggle .bar{
  display:block;
  width:18px;
  height:2px;
  background:var(--muted);
  border-radius:4px;
} */
.nav-toggle:focus{ outline:2px solid var(--link); outline-offset:2px; }

/* overlay behind the drawer (no blur) */
.scrim{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);  /* no blur, just a dark overlay */
  z-index:1000;                /* below .sidebar (1001) so taps hit the menu */
}
/* when menu is open */
body.nav-open .scrim{ display:block; }


/* Desktop unchanged; switch at 900px */
@media (max-width: 900px){
  .layout{ grid-template-columns: 1fr; }
  .nav-toggle{ display:inline-flex; }

  .sidebar{
    position:fixed; top:0; bottom:0; left:0;
    width:80vw; max-width:320px;
    transform:translateX(-100%);
    transition:transform .20s ease;
    z-index:1001;
    min-height:auto;
    background:var(--bg-soft);     /* solid panel so it isnâ€™t see-through */
    box-shadow:0 10px 40px rgba(0,0,0,.45);
    border-right:1px solid var(--border);
  }

  /* open states */
  .sidebar.open{ transform:translateX(0); }
  body.nav-open .scrim{ display:block; }
  body.nav-open{ overflow:hidden; } /* prevent background scroll */
}
/* Mobile compaction for the top bar */
@media (max-width: 900px){
  .topbar{
    flex-wrap:wrap;
    gap:8px 10px;
    padding:8px 12px;
  }

  /* Put chips on the first line (right side), breadcrumbs below */
  .nav-toggle{ order:0; }
  .back{ order:1; margin:0; }
  .topbar-right{ order:2; margin-left:auto; }
  .crumbs{
    order:3;
    width:100%;
    font-size:12px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    opacity:.9;
  }
  .crumbs .sep{ margin:0 4px; }

  /* tighter chips on small screens */
  .score .kpi{ padding:6px 8px; }
  /* hide long labels on mobile to save space */
  .score .kpi::after{ content:""; }
}

/* On wider screens, show the labels after the numbers for clarity */
@media (min-width: 901px){
  .score .kpi::after{
    content:" " attr(data-label);
    color:var(--muted);
    font-weight:600;
    margin-left:4px;
  }
}

/* === Global scale knob for question + options === */
:root{ --q-scale: 1.5; }          /* try 1.15 or 1.25 on mobile */

/* Question/flashcard text size */
.flashcard{
  font-size: calc(20px * var(--q-scale));
  min-height: calc(88px * var(--q-scale));   /* grows the card too */
  line-height: 1.25;
}

/* MCQ options */
#options{
  gap: calc(10px * var(--q-scale));
}
#options li button{
  font-size: calc(15px * var(--q-scale));
  padding: calc(10px * var(--q-scale)) calc(12px * var(--q-scale));
  min-height: calc(44px * var(--q-scale));
  line-height: 1.35;
}

/* Dual-MCQ buttons (if you use that mode) */
.dual-grid{ gap: calc(10px * var(--q-scale)); }
.dual-grid button{
  font-size: calc(15px * var(--q-scale));
  padding: calc(10px * var(--q-scale));
  min-height: calc(44px * var(--q-scale));
}

/* Writing mode input */
#write-input.pg-input{
  font-size: calc(16px * var(--q-scale));
  padding: calc(10px * var(--q-scale)) calc(12px * var(--q-scale));
  min-height: calc(52px * var(--q-scale));
}

/* Keep long terms from overflowing */
.flashcard, #options li button{
  word-break: break-word;
  white-space: normal;
}

/* Optional: auto-bump size on phones */
@media (max-width: 900px){
  :root{ --q-scale: 1.2; }
}

/* Optional: switch MCQ to 1 column on very small phones */
/*
@media (max-width: 420px){
  #options{ grid-template-columns: 1fr; }
}
*/
/* Center the text inside question flashcards (MCQ + Writing) */
#question-box,
#write-card{
  display: flex;              /* safe for multiple children */
  flex-direction: column;
  justify-content: center;    /* vertical center */
  align-items: center;        /* horizontal center for block children */
  text-align: center;         /* center the text itself */
}

/* (optional) keep long words from overflowing */
#question-box, #write-card{
  word-break: break-word;
  white-space: normal;
}

/* Menu toggle: icon + text label, clearer than hamburger */
.nav-toggle{
  display:inline-flex;
  align-items:center;
  gap:8px;
  border:1px solid var(--border);
  background:var(--panel);
  padding:8px 12px;
  border-radius:12px;
}
.nav-toggle .ico{ fill: var(--text); opacity:.9; }
.nav-toggle .label{
  color: var(--text);
  font-weight:600;
  font-size:14px;
  letter-spacing:.2px;
}
.nav-toggle:focus{ outline:2px solid var(--link); outline-offset:2px; }

/* (Optional) slightly tighter on very small phones */
@media (max-width: 380px){
  .nav-toggle{ padding:6px 10px; }
  .nav-toggle .label{ font-size:13px; }
}

/* Hide menu toggle on desktop; show only on mobile */
#nav-toggle{ display:none; }

@media (max-width: 900px){
  #nav-toggle{ display:inline-flex; }
}
@media (min-width: 901px){
  #nav-toggle{ display:none !important; }
}

/* Tabs (Video/Vocab/Grammar): donâ€™t show focus ring unless keyboard users */
#lesson-area .lesson-bar button:focus { outline: none; box-shadow: none; }
#lesson-area .lesson-bar button:focus-visible { outline: 2px solid var(--link); outline-offset: 2px; }
/* Fix collision: keep leaderboard score as a real table cell */
.leaderboard-table td.score{
  display: table-cell !important;
  text-align: right;
  vertical-align: middle;
}

/* === MCQ options layout =============================== */
/* Desktop (and tablets â‰¥901px): vertical list (1 column) */
#practice #options{
  display: grid;
  grid-template-columns: 1fr;
  gap: 10px;
  align-content: start;
}
#practice #options li{ width: 100%; }
#practice #options li button{
  width: 100%;
  text-align: left;         /* feels like a list; change to center if you prefer */
}

/* Mobile: keep your existing 2-left / 2-right grid */
@media (max-width: 900px){
  #practice #options{
    grid-template-columns: repeat(2, minmax(150px, 1fr));
    gap: 12px;
  }
}

/* Dual MCQ stays as-is (two columns) â€” this rule is just for clarity */
#practice .dual-grid{ display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
/* ==== Dual MCQ mobile layout fix ==== */
/* Let the dual grid span the whole #options width, not just column 1 */
#practice #options .dual-grid{
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 12px;
  align-items: start;
}

/* Stack the four buttons in each column with consistent spacing */
#practice #options .dual-grid > div{
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* Make buttons fill their column and remove stray margins from global rules */
#practice #options .dual-grid button{
  width: 100%;
  margin: 0;
  text-align: center;
}
/* Make Word Matching grid fill the options area */
#practice #options .match-grid{
  grid-column: 1 / -1;
}

/* Tighten button sizing with the same scale knobs */
#practice #options .match-grid .match-btn{
  width: 100%;
  text-align: center;
}

/* Mobile: keep columns readable and balanced */
@media (max-width: 900px){
  .match-grid.cols-2{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
  .match-grid.cols-3{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
  /* slightly larger gaps on small screens already handled by --q-scale */
}

/* Learn â†’ Table view */
.learn-table-bar{
  display:flex; gap:8px; align-items:center; justify-content:space-between;
  margin-bottom:8px;
}
.learn-table{
  width:100%; border-collapse:separate; border-spacing:0;
}
.learn-table thead th{
  background:#0f1727; position:sticky; top:0; z-index:1;
  text-align:left; cursor:pointer;
}
.learn-table th, .learn-table td{
  padding:10px 12px; border-bottom:1px solid var(--border); white-space:nowrap;
}
.learn-table tbody tr:nth-child(odd){ background:rgba(255,255,255,.02); }
.learn-table td.kanji{ font-weight:700; font-size:1.05em; }
.learn-table td.hira{ color:#eaf0ff; }
.learn-table td.en{ color:var(--muted); }

.lt-audio-col{ width:82px; text-align:center; }
.lt-audio-btn{ border-radius:999px; padding:6px 10px; }

/* ===== Learn Table â€” responsive & column hide ===== */

/* Chip group & toolbar layout */
.lt-toolbar{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
.lt-cols{ display:flex; gap:6px; flex-wrap:wrap; }
.lt-cols label.chip{
  display:flex; align-items:center; gap:6px;
  cursor:pointer;
}
.lt-cols input{ accent-color: var(--accent); }

/* Hide columns when toggled off */
#learn-table.hide-col-kanji  td.kanji,  #learn-table.hide-col-kanji  th[data-k="kanji"]{ display:none; }
#learn-table.hide-col-hira   td.hira,   #learn-table.hide-col-hira   th[data-k="hira"]{  display:none; }
#learn-table.hide-col-en     td.en,     #learn-table.hide-col-en     th[data-k="en"]{    display:none; }
#learn-table.hide-col-audio  td.acts,   #learn-table.hide-col-audio  th.lt-audio-col{     display:none; }

/* Mobile tweaks: tighter spacing + allow wrapping so it fits */
@media (max-width: 900px){
  .learn-table-bar{ flex-direction: column; align-items: stretch; gap:6px; }
  .lt-toolbar{ justify-content: space-between; }
  .learn-table th,
  .learn-table td{
    padding: 8px 10px;
    white-space: normal;            /* allow wrap instead of forcing horizontal scroll */
  }
  .lt-audio-col{ width: 56px; }     /* narrower audio col */
  #learn-table .table-wrap{
    max-width: 100%;
    overflow-x: auto;
  }
}

/* Word Table â€” filter input sizing */
#lt-filter.pg-input{
  flex: 1 1 auto;   /* fills horizontal space */
  width: 100%;
  min-height: 40px;
  height: auto;
  font-size: 16px;
  line-height: 1.25;
  /* optional: make it visually slimmer if needed */
  padding-block: 8px;
}

@media (max-width: 900px){
  #lt-filter.pg-input{
    min-height: 38px;
    font-size: 15px;
  }
}

/* Word Table â€” put toggles under the filter on all screens */
.learn-table-bar{
  display: flex;
  flex-direction: column;   /* stack filter, then toolbar */
  align-items: stretch;
  gap: 8px;
}

/* tidy toolbar + chips */
.lt-toolbar{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
.lt-cols{ display:flex; gap:6px; flex-wrap:wrap; }

/* small breathing room above table */
#learn-table .table-wrap{ margin-top: 6px; }

/* === Word Matching grid === */
.match-grid{
  display: grid;
  gap: 12px;
  margin-top: 10px;
}
.match-grid.cols-2{ grid-template-columns: 1fr 1fr; }
.match-grid.cols-3{ grid-template-columns: 1fr 1fr 1fr; }

.match-col{
  display: grid;
  /* Instead of forcing 5 rows, let the number of buttons define rows */
  grid-auto-rows: minmax(0, 1fr);
  gap: 10px;
}


.match-col .match-btn{
  width: 100%;
  padding: 10px 12px;
  border-radius: 12px;
  text-align: center;
  border: 1px solid var(--border);
  background: #0c1321;
  font-weight: 600;
}

.match-col .match-btn.is-selected{
  outline: 2px solid #4d74ff;
  background:#14234a;
}

.match-col .match-btn.is-solved{
  opacity: .55;
  background:#0f1727;
  border-color:#243657;
  cursor: default;
}
/* Word Matching state colors */
.match-col .match-btn.is-correct{
  border-color: #1b5a2c;
  background: #0e2a18;
  color: #bcffc9;
}
.match-col .match-btn.is-wrong{
  border-color: #5a1b1b;
  background: #2a0e0e;
  color: #ffd0d0;
}

/* --- Word List (small helpers) --- */
.wl-list{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap:10px;
}
.wl-item{
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
  background:#0e1524;
}
.wl-item h4{ margin:4px 0 2px; }
.wl-item .muted{ font-size:.9em; }
